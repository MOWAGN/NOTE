# 静态库制作与使用
## 静态库制作
### 库
- 库文件是计算机的一类文件，可看成代码仓库，提供可以直接拿来用的变量、函数或类
- 库不能单独运行，是一类特殊程序
- 库文件分类
    - 静态库和动态库（共享库）
    - 区别
    ```
    静态库在程序的链接阶段被复制到程序中
    动态库在链接阶段没有被复制到程序中，而是由程序在运行时由系统动态加载到内存中供程序使用
    ```
- 库的好处
    - 代码保密
    - 方便部署和分发

### 静态库制作
#### 命名规则
- Linux： `libxxx.a`
    - lib ：前缀（固定）
    - xxx : 库的名字，自定义
    - .a ：后缀（固定）
- windows：`libxxx.lib`
#### 静态库的制作
- gcc 获得 .o 文件；
    - 树形结构命令显示文件目录 `tree`
        - 如果没有，则使用 `sudo apt install tree` 安装
        ![](vx_images/341725112226461.png =400x)
        - **.o文件获取不包括头文件和测试程序（main.c）**
    - .o 文件获取命令 `gcc -c add.c sub.c mult.c div.c -I ../include/`
        - 其中 `-I` 用来包含上述 .c 程序中所包含的头文件目录。
- 将 .o 文件打包，使用 `ar` 工具（archive）
    - `ar rcs libxxx.a xxx1.o xxx2.o
        - r ：将文件插入备存文件中
        - c ：建立备存文件
        - s ：索引

## 静态库的使用
- 🐖注意：分发过程中需要把库文件和对应的头文件一起分发给用户，库文件的函数需要依靠头文件中对应的函数声明
- 使用命令
    - `gcc main.c -o app -I ../include/ -l xxx -L ./lib`
        - `-o` 编译成可执行文件，其后跟自定义可执行文件名；
        - `-I` 指定include包含文件目录，虽然在生成库前的 .o 文件编译可能已经指定过对应的 .h 文件，但是 main.c 生成可执行文件过程中可能需要重新指定；
        - `-l` 指定编译时使用的库，xxx为静态库文件libxxx.a中自定义的库文件名部分；
        - `-L` 指定搜索的库的路径；

