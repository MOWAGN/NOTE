# GDB调试
## GDB概述
### GDB定义
- GDB是由GNU软件系统社区提供的调试工具，同GCC配套组成一套完整的开发环境，GDB是Linux和许多类Unix系统中的标准开发环境。
- 一般来说，GDB主要帮助用户完成下面四个方面的功能
    ```
    启动程序，可以按照自定义要求运行程序；
    可以让调试程序在指定的调试断点处停住（断点可以是条件表达式）；
    当程序被停住，可以检查此时程序中发生的事；
    可以改变程序，将一个BUG产生的影响修正从而测试其他BUG。
    ```
    
### 准备工作
- 通常，在为调试而编译时，会 ( ) 关掉编译器的优化选项  ( `-o` ) ，并打开选项 ( ` -g ` ) 。另外，`-Wall` 在尽量不影响程序行为的情况下选项打开所有warning，也可以发现许多问题，避免一些不必要的BUG。
- `gcc -g -Wall program.c -o program`
- （ `-g` ）  选项的作用是在可执行文件中加入源代码的信息，比如可执行文件中第几条机器指令对应源代码的第几行，但并不是把整个源文件嵌入到可执行文件中，所以在调试时必须保证gdb能找到源文件。

## GDB命令
### 启动和退出
- `gdb 可执行程序`
    - 说明：这是一条shell命令，除此之外，下述均为GDB命令。
    - 🐖 调试过程中源代码文件和对应生成的可执行程序要在一个路径下，否则会报错
- `quit`

### 给程序设置参数/获取设置参数
- `set args 10 20`
- `show args`

### GDB使用帮助
- `help`

### GDB查看命令
#### 查看当前文件代码
- `list/l`
    - 说明
        - `list` 和 `l` 均表示从默认位置开始显示。
        - 每次输入显示10行含有行数信息的源代码，按回车或重新输入 `list` 继续往下显示代码。
- `list/l`
    - 说明：从默认位置显示
- `list/l 行号`
    - 说明：从指定行开始显示
    - vim命令查看源代码行号：`:set nu`
- `list/l 函数名`
    - 说明：从指定函数显示

#### 查看非当前文件代码
- `list/1 文件名：行号`
- `list/1 文件名：函数名`

#### 设置显示行数
- `show list/listsize`
- `set list/listsize 函数`
- 如果不设置，默认为10行。

### 断点操作
#### 设置断点
- `b/break 行号`
    - 说明：断点设置在源文件对应行数
    - ![](vx_images/304532617238675.png =350x)
- `b/break 函数名`
- `b/break 文件名：行号`
- `b/break 文件名：函数`

#### 查看断点
- `i/info b/break`

#### 删除断点
- `d/del/delete 断点编号`
    - 说明：删除断点并不会对断点进行重新编号，删除的编号不会再进行重新指定。删除后如果设置别的断点，会按照删除前的编号往下配置
    - ![](vx_images/244773317226542.png =500x)

#### 使能断点
- `dis/disable 断点编号`
    - 说明：设置断点为无效
- `ena/enable 断点编号`
    - 说明：设置断点生效

#### 设置条件断点
- `b/break 循环开始所在行数 if 条件变量==x`

### 调试命令

#### 运行GDB程序
- `start`
    - 说明：程序停在第一行
- `run`
    - 说明：运到断点才停

#### 继续运行直至下个断点
- `c/continue`

####  向下执行一行代码
- `n/next`
    - 说明：不会进入函数体

#### 变量操作
- `p/print 变量名`
    - 说明：打印变量值
- `ptype 变量名`
    - 说明：打印变量类型

#### 单步执行
- `s/step`
    - 说明：遇到函数进入函数体，这也是与 `next` 的区别
- `finish`
    - 说明：跳出函数体
    - 要求：函数内不能有断点

#### 自动变量操作
- `display 变量名称`
    - 说明：自动打印指定变量的值
- `i/info display`
- `undisplay 编号`

#### 其他操作
- `set var 变量名=变量值`
- `until`
    - 说明：跳出循环
    - 条件：要想使用本命令跳出循环，要求循环内不能有断点，而且要执行到循环的最后一行（即循环for或while开始的一行）


